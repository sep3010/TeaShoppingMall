<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.kosmo.pse.mapper.BoardMapper">
	<resultMap type="edu.kosmo.pse.vo.BoardVO" id="boardMap">
		<result property="rnum" column="rnum" />
		<result property="boardId" column="board_id" />
		<result property="boardTitle" column="board_title" />
		<result property="boardContent" column="board_content" />
		<result property="userId" column="user_id" />
		<result property="writeDate" column="write_date" />
		<result property="boardHit" column="board_hit" />
		<result property="boardGroup" column="board_group" />
		<result property="rewriteDate" column="rewrite_date" />
		<result property="boardTypeId" column="board_type_id" />
		<result property="boardLock" column="board_lock" />
		<result property="productId" column="product_id" />
		<result property="starRating" column="star_rating" />
		<result property="orderId" column="order_id" />
		<result property="boardCategory" column="board_category" />
		<result property="boardTypeName" column="board_type_name" />
	</resultMap>

	<resultMap type="edu.kosmo.pse.vo.BoardTypeVO" id="boardTypeMap">
		<result property="boardTypeId" column="board_type_id" />
		<result property="boardTypeName" column="board_type_name" />
	</resultMap>
	
	<resultMap type="edu.kosmo.pse.vo.ReplyVO" id="replyMap">
		<result property="replyId" column="reply_id" />
		<result property="boardGroup" column="board_group" />
		<result property="replyStep" column="reply_step" />
		<result property="replyIndent" column="reply_indent" />
		<result property="boardId" column="board_id" />
		<result property="userId" column="user_id" />
		<result property="replyWriteDate" column="reply_write_date" />
		<result property="replyContent" column="reply_content" />
	</resultMap>
	
	<select id="getNoticeBoardList" resultMap="boardMap">
		<![CDATA[
			SELECT * FROM (
	              SELECT ROWNUM AS rnum, A.* FROM (
	                       SELECT b.board_id, b.board_title, b.board_content,
		b.user_id, b.write_date, b.board_hit, b.board_group, 
		b.rewrite_date, b.board_type_id, b.board_lock, o.product_id, 
        b.star_rating, o.order_id, b.board_category, t.board_type_name 
		FROM board b LEFT JOIN board_type t 
		ON b.board_id = t.board_type_id 
        LEFT JOIN order_detail o ON b.order_id = o.order_id 
        WHERE b.board_type_id = 1 ORDER BY b.board_id ASC  
	             ) A WHERE ROWNUM <= #{pageNum} * 10
	         ) WHERE rnum > (#{pageNum} - 1) * 10 ORDER BY rnum DESC
	    ]]> 
	</select>
	
	<select id="getQuestionBoardList" resultMap="boardMap">
		<![CDATA[
			SELECT * FROM (
	              SELECT ROWNUM AS rnum, A.* FROM (
	                       SELECT b.board_id, b.board_title, b.board_content,
		b.user_id, b.write_date, b.board_hit, b.board_group, 
		b.rewrite_date, b.board_type_id, b.board_lock, o.product_id, 
        b.star_rating, o.order_id, b.board_category, t.board_type_name 
		FROM board b LEFT JOIN board_type t 
		ON b.board_id = t.board_type_id 
        LEFT JOIN order_detail o ON b.order_id = o.order_id 
        WHERE b.board_type_id = 2 ORDER BY b.board_id ASC  
	             ) A WHERE ROWNUM <= #{pageNum} * 10
	         ) WHERE rnum > (#{pageNum} - 1) * 10 ORDER BY rnum DESC
	    ]]> 
	</select>
	
	<select id="getReviewBoardList" resultMap="boardMap">
		<![CDATA[
			SELECT * FROM (
	              SELECT ROWNUM AS rnum, A.* FROM (
	                       SELECT b.board_id, b.board_title, b.board_content,
		b.user_id, b.write_date, b.board_hit, b.board_group, 
		b.rewrite_date, b.board_type_id, b.board_lock, o.product_id, 
        b.star_rating, o.order_id, b.board_category, t.board_type_name 
		FROM board b LEFT JOIN board_type t 
		ON b.board_id = t.board_type_id 
        LEFT JOIN order_detail o ON b.order_id = o.order_id 
        WHERE b.board_type_id = 3 ORDER BY b.board_id ASC  
	             ) A WHERE ROWNUM <= #{pageNum} * 10
	         ) WHERE rnum > (#{pageNum} - 1) * 10 ORDER BY rnum DESC
	    ]]> 
	</select>
	
	<select id="getBoard" resultMap="boardMap">
		SELECT ROWNUM AS rnum, b.board_id, b.board_title, 
		b.board_content, b.user_id, b.write_date, b.board_hit, 
		b.board_group, b.rewrite_date, b.board_type_id, b.board_lock, 
		o.product_id, b.star_rating, o.order_id, b.board_category, 
		t.board_type_name FROM board b 
		LEFT JOIN board_type t 
		ON b.board_id = t.board_type_id 
		LEFT JOIN order_detail o 
		ON b.order_id = o.order_id  
		WHERE b.board_id = #{boardId}
	</select>
	
	<insert id="insertBoard">
		INSERT INTO board VALUES (BOARD_SEQ.nextval, 
		#{boardTitle}, #{boardContent}, #{userId}, SYSDATE, 0, 
		BOARD_SEQ.CURRVAL, null, #{boardTypeId}, #{boardLock}, 
		#{productId}, #{starRating}, #{orderId}, #{boardCategory})
	</insert>
	
	<update id="updateNotice">
		UPDATE board SET board_title = #{boardTitle}, board_content = #{boardContent}, 
		rewrite_date = SYSDATE WHERE board_id = #{boardId}
	</update>
	
	<update id="updateQuestion">
		UPDATE board SET board_title = #{boardTitle}, board_content = #{boardContent}, 
		rewrite_date = SYSDATE, board_lock = #{boardLock}, board_category = #{boardCategory} 
		WHERE board_id = #{boardId}
	</update>
	
	<select id="getReplyList" resultMap="replyMap">
		SELECT * FROM reply WHERE board_id = #{boardId} ORDER BY reply_step ASC, reply_write_date ASC
	</select>
	
	<insert id="insertReply">
		INSERT INTO reply VALUES (REPLY_SEQ.nextval, #{boardGroup}, 
		#{replyStep}, #{replyIndent}, #{boardId}, #{userId}, SYSDATE, #{replyContent})	
	</insert>
	
	


</mapper>	